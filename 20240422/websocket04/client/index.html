<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/bootstrap.css">
    <style>
       html, body{
height: 100%;
}
.main .down{
height: 55px;
}
.main .up{
height: calc(100% - 55px);
}
.main .right{
width: 170px;
}
.main .left{
width: calc(100% - 170px);
overflow-y: scroll;
}
    </style>
    <title>client</title>
</head>

<body>
    <div class="container-lg h-100 bg-primary-subtle p-2 main d-flex flex-column">
        <div class="up d-flex">
        <div class="left bg-warning-subtle me-1 p-1"></div>
        <div class="right bg-secondary-subtle h-100 rounded-1 p-1">
        </div>
        </div>
        <div class="input-group input-group-lg my-2 down">
        <input type="text" class="form-control" name="msg">
        <div class="btn btn-primary input-group-text btn-send">送出訊息</div>
        </div>
        </div>

    <script>
        const ws = new WebSocket("ws://localhost:8080")
        const userID = new Date().getTime().toString();
        let clientList;

        ws.addEventListener("open", () => {
            console.log('新的使用者連線,註冊使用者ID');
            let params = {
                type: "register",
                userID
            }
            ws.send(JSON.stringify(params));
        });

        ws.addEventListener("message", async event => {
            const result = JSON.parse(event.data);
            console.log(result);
            if (result.type === "registered") {
                clientList = result.otherClients;
                setClientList()
            }
            if (result.type === "disconnected") {
                clientList = result.otherClients;
                setClientList()
            }
        })

        function setClientList() {
            let clientDOM = "<div>";
            clientList.forEach(client => {
                let myself = (client === userID) ? "myself" : "";
                clientDOM += `<div class="${myself}">${client}</div>`
            });
            clientDOM += "</div>"
            document.querySelector("body").innerHTML = clientDOM;
        }
    </script>
</body>

</html>